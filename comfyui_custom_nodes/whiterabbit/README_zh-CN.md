# WhiteRabbitï¼šæŒæ§æ—¶é—´ä¹‹æµ ğŸ‡
[English](readme.md) | **ç®€ä½“ä¸­æ–‡**

è¿™æ˜¯ **comfyui-WhiteRabbit**ï¼Œä¸€ä¸ªä¸“ä¸ºåœ¨ ComfyUI ä¸­å¤„ç†è§†é¢‘è€Œè®¾è®¡çš„èŠ‚ç‚¹åŒ…ã€‚

å…”å­çš„æ‹¿æ‰‹å¥½æˆæ˜¯ç©¿æ¢­æ—¶é—´ï¼Œå¸®ä½ åšå‡ºæ— ç¼å¾ªç¯è§†é¢‘ã€‚ä½†å¥¹å¸¦æ¥çš„å¯ä¸æ­¢è¿™äº›â€”â€”é«˜è´¨é‡çš„ä»»æ„å¸§ç‡é‡é‡‡æ ·å’Œè¶…å¿«çš„å›¾åƒç¼©æ”¾ä¹Ÿéƒ½åœ¨è¿™ä»½â€œèŒ¶ä¼šâ€ç¤¼ç›’é‡Œï¼

è™½ç„¶è¿™äº›èŠ‚ç‚¹ä¸­æœ‰äº›å½“ç„¶ä¹Ÿèƒ½ç”¨äºå•å¼ å›¾ç‰‡ï¼Œä½†å®ƒä»¬æ— ä¸€ä¸æ˜¯ä»¥é«˜æ•ˆçš„**æ‰¹å¤„ç†**ä¸ºæ ¸å¿ƒè®¾è®¡ã€‚è¿™æ„å‘³ç€æ€§èƒ½æ”¶ç›Šä¼šå±‚å±‚å åŠ ï¼Œè®©ä½ åœ¨ç¡¬ä»¶å…è®¸çš„èŒƒå›´å†…å°½å¯èƒ½å¿«åœ°å¤„ç†æ•´æ®µè§†é¢‘ã€‚


## å®‰è£…

WhiteRabbit æ”¯æŒä¸¤ç§å¸ƒå±€ï¼š

1) **å¤–éƒ¨åŸºç¡€åŒ…ï¼ˆå­˜åœ¨æ—¶ä¼˜å…ˆï¼‰**ï¼š`custom_nodes/comfyui-frame-interpolation/`
2) **å†…ç½®çš„åº”æ€¥å‰¯æœ¬ï¼ˆéšæœ¬é¡¹ç›®æ‰“åŒ…ï¼‰**ï¼š`vendor/`

**å¿«é€Ÿå®‰è£…ï¼š**
1. å°† **comfyui-WhiteRabbit** æ–‡ä»¶å¤¹æ”¾å…¥ `ComfyUI/custom_nodes/`ã€‚
2. å®‰è£…æœ¬èŠ‚ç‚¹æ‰€éœ€çš„ä¾èµ–ï¼š
   ```bash
   pip install -r requirements.txt
   ```

**å¯é€‰é¡¹ï¼š** ä½ å¯ä»¥åœ¨ `custom_nodes/` ç›®å½•ä¸­å®‰è£… [ComfyUI-Frame-Interpolation](https://github.com/Fannovel16/ComfyUI-Frame-Interpolation)ã€‚WhiteRabbit ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°å®ƒå¹¶å¤ç”¨å…¶ä¸­çš„èµ„æºã€‚å¦‚æœä½ å·²ç»åœ¨ç”¨å®ƒï¼Œè¿™å°¤å…¶æ–¹ä¾¿ï¼Œå› ä¸ºæ— éœ€åŒæ—¶ä¿å­˜ä¸¤ä»½ RIFE æ¨¡å‹ã€‚

### Python ä¾èµ–

æœ¬èŠ‚ç‚¹ä¾èµ–äº ComfyUI å·²æä¾›çš„æ ¸å¿ƒåŒ…ï¼ˆå¦‚ `torch`ã€`torchvision`ã€`numpy`ã€`einops`ã€`pyyaml`ï¼‰ã€‚ä½ çš„**èŠ‚ç‚¹æœ¬åœ°** `requirements.txt` ä»…éœ€æ–°å¢ï¼š

```
packaging
torchlanc
```

## èŠ‚ç‚¹ä¸€è§ˆ

è¿™ä¸ªèŠ‚ç‚¹åŒ…å¸®ä½ è§£å†³è§†é¢‘åˆ›ä½œä¸­ä¸€äº›æœ€æ£˜æ‰‹çš„é—®é¢˜ã€‚

### æ—¶é—´æ‰­æ›²è€…ï¼ˆTime Bendersï¼‰

è¿™äº›èŠ‚ç‚¹é€šè¿‡ **RIFE** æ’å¸§æ¨¡å‹åœ¨æ—¶é—´ä¸Šå¢åˆ å¸§ã€‚ä¸ºäº†è·å¾—ä¸€ç‚¹ç‚¹é¢å¤–é€Ÿåº¦ï¼Œå®ƒä»¬è¢«ä¼˜åŒ–ä¸ºååŒå·¥ä½œï¼Œåœ¨å¤š RIFE å·¥ä½œæµä¸­ç¼“å­˜ RIFE æ¨¡å‹ï¼Œä»¥è·å¾—å°å¹…æ•ˆç‡æå‡ã€‚

- **RIFE VFI Interpolate by Multiple**ï¼šå¸§æ’å€¼çš„åŸºç¡€å·¥å…·ã€‚å°†å¸§æ•°ä¹˜ä»¥ 2xã€4x ç­‰ï¼Œå®ƒä¼šç”Ÿæˆè®©ä½ çš„è§†é¢‘ä¸æ»‘æµç•…çš„æ–°å¸§ã€‚
- **RIFE VFI FPS Resample**ï¼šæ—¶é—´æ—…è¡Œå¤§å¸ˆã€‚æŠŠè§†é¢‘è½¬æ¢ä¸ºæŒ‡å®šç›®æ ‡å¸§ç‡ï¼Œè‡ªåŠ¨å¤„ç†è¡¥å¸§ä¸ä¸¢å¸§ã€‚å†…ç½®å¤šç§é˜²æ­¢å¸¸è§ä¼ªå½±ï¼ˆå¦‚é—ªçƒï¼‰çš„æªæ–½ï¼Œè¾“å‡ºæ›´å¹²å‡€ã€‚
- **RIFE VFI Custom Timing**ï¼šéœ€è¦å®Œå…¨æŒæ§ï¼Ÿä»¥â€œå¤–ç§‘çº§ç²¾åº¦â€æ”¾ç½®æ¯ä¸€å¸§ã€‚é€šè¿‡æä¾›è‡ªå®šä¹‰æ—¶åºåˆ—è¡¨æ¥åˆ¶ä½œé€Ÿåº¦å¡é“ï¼Œæˆ–åªåœ¨ç‰¹å®šæ—¶åˆ»è¿›è¡Œå¹³æ»‘å¤„ç†ã€‚
- **RIFE Seam Timing Analyzer**ï¼šè‡ªå®šä¹‰æ—¶åºèŠ‚ç‚¹çš„å®Œç¾æ­æ¡£ã€‚è‡ªåŠ¨è®¡ç®—æ— ç¼å¾ªç¯çš„ç²¾ç¡®æ—¶åºï¼Œç»™å‡ºä½ éœ€è¦çš„ CSV æ•°å€¼ï¼Œè®©è¿‡æ¸¡å¤©è¡£æ— ç¼ã€‚

![resample_framerate](examples/resample_framerate.png)
> ç¤ºä¾‹ï¼š**RIFE VFI FPS Resample** èŠ‚ç‚¹æ˜¯â€œæ—¶é—´å¤§å¸ˆâ€ï¼Œå¯å°†ä½ çš„è§†é¢‘é‡é‡‡æ ·åˆ°æ–°çš„å¸§ç‡ã€‚è‡ªå·±è¯•è¯•å§â€”â€”é™„å¸¦å·¥ä½œæµï¼

### å¾ªç¯å¤§å¸ˆï¼ˆLoop Mastersï¼‰

åšå‡ºä¸€ä¸ªæ— ç¼å¾ªç¯çš„è§†é¢‘å¸¸åƒè§£è°œã€‚è¿™äº›èŠ‚ç‚¹æŠŠå¼€å¯å®Œç¾ã€è¿ç»­å¾ªç¯çš„é’¥åŒ™äº¤ç»™ä½ ã€‚

- **Prepare Loop Frames**ï¼šç¬¬ä¸€æ­¥ã€‚è¯¥èŠ‚ç‚¹ä¼šå¤„ç†æ•´æ®µè§†é¢‘ä»¥å‡†å¤‡å¾ªç¯â€œæ¥ç¼â€ï¼Œå°†æœ€åä¸€å¸§ä¸ç¬¬ä¸€å¸§å•ç‹¬æ‰“æˆä¸€ä¸ªæ‰¹ã€‚è¿™ä¸€å°å¯¹å¸§å°±æ˜¯ä½ çš„æ’å¸§å™¨å¼€å§‹è¿‡æ¸¡æ‰€éœ€çš„ä¸€åˆ‡ã€‚
- **Assemble Loop Frames**ï¼šæœ€åä¸€å—æ‹¼å›¾ã€‚æ’å¸§å™¨æ–½å±•é­”æ³•åï¼Œè¯¥èŠ‚ç‚¹ä¼šæŠŠæ–°çš„æ¥ç¼å¸§è¿½åŠ åˆ°åŸè§†é¢‘çš„æœ«å°¾ï¼Œç»„è£…å‡ºå®Œæ•´ã€è¿ç»­çš„å¾ªç¯ã€‚
- **Autocrop to Loop**ï¼šåˆ«åœ¨å¸§çš„æ£®æ—é‡Œè¿·è·¯ï¼è¿™ä¸ªèªæ˜çš„èŠ‚ç‚¹ä¼šæ™ºèƒ½åˆ†æè§†é¢‘ï¼Œä»æœ«å°¾æ‰¾åˆ°æœ€ä½³è£å‰ªç‚¹ï¼Œç¡®ä¿å¾ªç¯å°½å¯èƒ½é¡ºç•…ã€‚
- **Trim Batch Ends**ï¼šä¸€ä¸ªç”¨äºä»ç‰‡æ®µå¼€å¤´æˆ–ç»“å°¾è£æ‰å›ºå®šæ•°é‡å¸§çš„ç®€æ´å·¥å…·ï¼Œé€‚åˆå»æ‰ä¸éœ€è¦çš„å¼€åœº/æ”¶å°¾ã€‚
- **Roll Frames**ï¼šå¾ªç¯åœ°æ”¹å˜ä¸€æ‰¹å›¾åƒçš„é¡ºåºã€‚åœ¨å¾ªç¯åœºæ™¯ä¸­ï¼Œè¿™ä¼šæ”¹å˜ä½ çš„å¾ªç¯ä»ç¬¬å‡ å¸§å¼€å§‹ã€‚
- **Unroll Frames**ï¼šæ’¤é”€ä¸Šé¢èŠ‚ç‚¹çš„æ“ä½œï¼›ä½ å¯èƒ½ä¼šä¸ºäº†æŸä¸ªè¿‡ç¨‹ï¼ˆå¦‚æ’å¸§ï¼‰å…ˆæ»šåŠ¨å¸§ï¼Œå†æ¢å¤åŸé¡ºåºã€‚è¯¥èŠ‚ç‚¹æ”¯æŒè®¾ç½®å¸§ä¹˜æ•°ï¼Œä»¥ä¸ä¹‹å‰çš„ **RIFE VFI Interpolate by Multiple** ä¿æŒåŒæ­¥ã€‚

![interpolate_loop_seam](examples/interpolate_loop_seam.png)
> ç¤ºä¾‹ï¼šç”¨ **Prepare Loop Frames** â†’ **RIFE Seam Timing Analyzer** â†’ **RIFE VFI Custom Timing** â†’ **Assemble Loop Frames** ç¼åˆæ— ç¼å¾ªç¯ã€‚æŠŠè¿™å¼  png ä¸¢è¿› ComfyUI äº²è‡ªè¯•é©¾ï¼

![interpolate_loop_seam](examples/autocrop_to_loop.png)
> ç¤ºä¾‹ï¼šæœ€å¥½çš„å¾ªç¯å°±æ˜¯ä½ å·²ç»æ‹¥æœ‰çš„é‚£ä¸ªã€‚**Autocrop to Loop** é€šè¿‡åˆ†æç‰‡æ®µå°¾éƒ¨å¸§ä¹‹é—´çš„è§†è§‰å·®å¼‚ä¸æ—¶åºï¼Œå¸®ä½ æ‰¾åˆ°æœ€ä½³ç»“æŸå¸§ã€‚

### åæœŸå¤„ç†ï¼ˆPost-Processingï¼‰

è¿™äº›èŠ‚ç‚¹æ˜¯å¾—åŠ›åŠ©æ‰‹ï¼

- **Batch Resize w/ Lanczos**ï¼šå¿«é€Ÿã€æ­£ç»Ÿã€å“è´¨ä¸å¦¥åã€‚è¿™ä¸ª CUDA åŠ é€Ÿçš„èŠ‚ç‚¹ä½¿ç”¨ä¸º PyTorch ç¼–å†™çš„é«˜è´¨é‡ Lanczos ç®—æ³• [TorchLanc](https://github.com/Artificial-Sweetener/TorchLanc) æ¥æ‰¹é‡ç¼©æ”¾å›¾åƒï¼ˆå½“ç„¶ä¹Ÿæ”¯æŒå•å¼ ï¼‰ã€‚å®ƒç›¸æ¯” CPU æ–¹æ¡ˆï¼ˆå¦‚ Pillow è‡ªå¸¦çš„ Lanczosï¼‰é€Ÿåº¦æ˜¾è‘—æ›´å¿«ï¼Œæœ€é«˜å¯è¾¾çº¦ *10Ã—* æå‡ã€‚
- **Upscale w/ Model (Advanced)**ï¼šComfyUI è‡ªå¸¦ â€œUpscale Image (Using Model)â€ çš„è¿›é˜¶ç‰ˆæœ¬ï¼Œç›´æ¥æš´éœ²æ‰¹å¤§å°ä¸åˆ‡ç‰‡ç­‰å‚æ•°ã€‚å¦‚æœæ ¹æ®ä½ çš„æœºå™¨è¿›è¡Œè°ƒä¼˜ï¼Œæ”¾å¤§é€Ÿåº¦èƒ½æ˜¾è‘—æå‡ã€‚
- **Pixel Hold**ï¼šé€šè¿‡æŠ‘åˆ¶ç”±è§†é¢‘æ‰©æ•£æˆ–å‹ç¼©é€ æˆçš„å°å¹…æ³¢åŠ¨ï¼Œå‡å°‘è§†é¢‘é—ªçƒå¹¶æ¸…ç†ç”»é¢ä¸­çš„é™æ€åŒºåŸŸã€‚ä¹Ÿå¯å°†è¾“å…¥å›¾åƒä½œä¸ºåŸºå‡†ï¼Œå…·å¤‡ä¸€å®šçš„åˆ›ä½œæ½œåŠ›ã€‚
- **Watermark**ï¼šæ”¯æŒå•å›¾ä¸æ‰¹é‡ã€‚éå¸¸å¿«é€Ÿï¼Œå°¤å…¶æ˜¯ä¸ä¸“ä¸šç¼–è¾‘å·¥å…·ä¸­åšåŒç±»æ“ä½œç›¸æ¯”ã€‚

![resize](examples/resize.png)
> ç¤ºä¾‹ï¼šä½¿ç”¨ **Batch Resize w/ Lanczos** å¿«é€Ÿç¼©æ”¾å›¾åƒã€‚å·²é™„å·¥ä½œæµï¼

![resize_with_model_to_target](examples/resize_with_model_to_target.png)
> ç¤ºä¾‹ï¼šå°† **Upscale w/ Model (Advanced)** ä¸ **Batch Resize w/ Lanczos** é…åˆä½¿ç”¨ï¼Œè¾¾åˆ°ç‰¹å®šç›®æ ‡å°ºå¯¸ã€‚å›¾ä¸­å·²é™„å¸¦å·¥ä½œæµã€‚

![watermark](examples/watermark.png)
> ç¤ºä¾‹ï¼šç”¨çµæ´»çš„é…ç½®é€‰é¡¹ä¸ºæ¯ä¸€å¸§å¿«é€Ÿæ·»åŠ æ°´å°ã€‚å·²é™„å·¥ä½œæµã€‚

## è®¸å¯ä¸è‡´è°¢
- **é¡¹ç›®è®¸å¯ï¼š** GNU Affero General Public License v3.0ï¼ˆ**AGPL-3.0**ï¼‰ã€‚è¯·é˜…è¯»æœ¬ä»“åº“å†…å®Œæ•´çš„ [LICENSE](LICENSE)ï¼AGPL-3.0 æ˜¯å¼º Copyleft è®¸å¯ã€‚å¦‚æœä½ åˆ†å‘æœ¬è½¯ä»¶ï¼Œä½ å¿…é¡»æä¾›å…¶å¯¹åº”çš„æºä»£ç ï¼›å¦‚æœä½ è®©ç”¨æˆ·é€šè¿‡ç½‘ç»œä¸ä¿®æ”¹è¿‡çš„ç‰ˆæœ¬äº¤äº’ï¼Œä½ ä¹Ÿå¿…é¡»å‘ä»–ä»¬æä¾›è¯¥ä¿®æ”¹ç‰ˆæœ¬çš„å¯¹åº”æºä»£ç ã€‚

- **ä¾èµ–è®¸å¯ï¼ˆMITï¼‰ï¼š** ä¸ºäº†å¯é æ€§ï¼Œæœ¬é¡¹ç›®**å†…ç½®ï¼ˆvendorï¼‰**äº† **[ComfyUI-Frame-Interpolation](https://github.com/Fannovel16/ComfyUI-Frame-Interpolation)** çš„æå°‘é‡ç»„ä»¶ã€‚è¿™äº›æ–‡ä»¶éµå¾ª MIT è®¸å¯ï¼Œç”± **[Fannovel16](https://github.com/Fannovel16)** ä¸å…¶**[è´¡çŒ®è€…](https://github.com/Fannovel16/ComfyUI-Frame-Interpolation/graphs/contributors)** æˆæƒï¼›å‚è§ `LICENSES/MIT-ComfyUI-Frame-Interpolation.txt`ï¼š
  - `vendor/vfi_utils.py`
  - `vendor/rife/__init__.py`
  - `vendor/rife/rife_arch.py`
- å¦å¤–ï¼Œæœ¬é¡¹ç›®ä¹Ÿåœ¨ [`interpolation.py`](interpolation.py) ä¸­å€Ÿé‰´å¹¶æ”¹ç¼–äº† **[ComfyUI-Frame-Interpolation](https://github.com/Fannovel16/ComfyUI-Frame-Interpolation)** çš„å°‘é‡å†…å®¹ã€‚
- **Batch Resize w/ Lanczos** çš„ UI è®¾è®¡å—åˆ°äº† [Kijai](https://github.com/kijai/) ä¼˜ç§€é¡¹ç›® [KJNodes](thub.com/kijai/ComfyUI-KJNodes) ä¸­ç›¸ä¼¼èŠ‚ç‚¹çš„å¯å‘ã€‚

### ç ”ç©¶å¼•ç”¨

æœ¬èŠ‚ç‚¹åŒ…åœ¨è§†é¢‘å¸§æ’å€¼ä¸Šä½¿ç”¨ **RIFEï¼ˆIFNetï¼‰**ã€‚ä½ å¯ä»¥åœ¨[è¿™é‡Œ](https://ar5iv.labs.arxiv.org/html/2011.06294)é˜…è¯»è®ºæ–‡ã€‚

```bibtex
@inproceedings{huang2022rife,
  title={Real-Time Intermediate Flow Estimation for Video Frame Interpolation},
  author={Huang, Zhewei and Zhang, Tianyuan and Heng, Wen and Shi, Boxin and Zhou, Shuchang},
  booktitle={European Conference on Computer Vision (ECCV)},
  year={2022}
}
```

---

## æ¥è‡ªå¼€å‘è€… â¤ï¸

å¸Œæœ›ä½ ä½¿ç”¨è¿™äº›èŠ‚ç‚¹æ—¶çš„å¿«ä¹ï¼Œä¸äºšäºæˆ‘æŠŠå®ƒä»¬æ‹¼åˆ°ä¸€èµ·æ—¶ï¼

- **è¯·æˆ‘å–æ¯å’–å•¡**ï¼šä½ å¯ä»¥åœ¨æˆ‘çš„ [Ko-fi é¡µé¢](https://ko-fi.com/artificial_sweetener) æ”¯æŒæ›´å¤šç±»ä¼¼é¡¹ç›®ã€‚
- **æˆ‘çš„ç½‘ç«™ä¸ç¤¾åª’**ï¼šæ¬¢è¿åœ¨ [artificialsweetener.ai](https://artificialsweetener.ai) æŸ¥çœ‹æˆ‘çš„è‰ºæœ¯ä½œå“ã€è¯—æ­Œä¸å¼€å‘åŠ¨æ€ã€‚
- **å¦‚æœä½ å–œæ¬¢è¿™ä¸ªé¡¹ç›®**ï¼Œåœ¨ GitHub ä¸Šç‚¹ä¸€é¢— Star ä¼šè®©æˆ‘éå¸¸å¼€å¿ƒï¼ï¼ â­
